import{a as b,u as I,b as q,r as f,j as t,F as c,M as Q}from"./index-Bz-J4q0w.js";import{F as C}from"./FadeIn-CMk5AFn5.js";import{u as y,I as p,g as k}from"./InputField-DQZZFl9F.js";import{o as M,s as h,n as P,u as V,a as w}from"./inputtext-DzKzWJF0.js";import{B}from"./Button-B05VXmkB.js";import{f as F,Q as x}from"./constants-D_Q6Mjeq.js";const D=M({title:h({required_error:"Назва є обов’язковою"}).min(2,"Назва є обов’язковим, не менше 3х символів"),description:h({required_error:"Опис є обов’язковим"}).min(4,"Опис є обов’язковим, не менше 10ти символів"),score:P({required_error:"Оцінка є обов’язковою",invalid_type_error:"Оцінка повинна бути числом"}).min(1,"Оцінка не може бути 0 мін. 1").max(10,"Оцінка не може бути більшою за 10"),date:h({required_error:"Дата є обов’язковою"}).min(8,"Дата є обов’язковою")}),H=()=>{const d=y({mutationFn:F.create,onError:n=>{console.log(n)}}),u=b(),{mutate:e,isPending:a}=d;return{create:n=>{e(n,{onSuccess(o){u.setQueryData([x.ALL_FISH],r=>{if(!r)return r;const l=r?.pages.map(g=>({...g,response:o}));return{...r,pages:l}})}})},isLoading:a}},R=d=>{const u=y({mutationFn:F.update,onError:a=>{console.log(a)},onSuccess(a){e.setQueryData([x.ALL_FISH],s=>{if(!s)return s;const n=s?.pages.map(o=>({...o,data:o.data.map(r=>a._id===r._id?a:r)}));return{...s,pages:n}}),e.setQueryData([x.ALL_FISH_USER],s=>{if(!s)return s;const n=s?.pages.map(o=>({...o,data:o.data.map(r=>a._id===r._id?a:r)}));return{...s,pages:n}})}}),e=b();return{updete:u.mutate,isLoading:u.isPending}},z=()=>{const d=I(),e=q().state,[a,s]=f.useState(),{create:n}=H(),{updete:o}=R(e.data?._id||""),r=async()=>{const i=e.position&&await k(e.position);s(i)};f.useEffect(()=>{!a&&r()},[]);const{register:l,handleSubmit:g,reset:j,formState:{errors:m,isValid:N}}=V({resolver:w(D),defaultValues:{title:e.data?e.data?.title:"",description:e.data?e.data?.description:"",score:e.data?e.data?.score:0,date:e.data?e.data?.date:""}}),S=async i=>{if(a&&e.position&&e.position.lat&&e.position.lng){const _={title:i.title.replace(/\s+/g," ").trim(),description:i.description.replace(/\s+/g," ").trim(),score:i.score,date:i.date,coords:[e.position.lat,e.position.lng],img:[],weather:a};n(_),d("/mypage")}j()},L=async i=>{if(e.data){const _={title:i.title.replace(/\s+/g," ").trim(),description:i.description.replace(/\s+/g," ").trim(),score:i.score,date:i.date},A=e.data?._id||"",E={...e.data,..._};o({_id:A,payload:E}),d(`/details/${e.data._id}`)}j()};return t.jsx(C,{children:t.jsxs(c,{column:!0,centerV:!0,spredV:!0,className:"addpage",children:[e.data?t.jsxs(c,{column:!0,center:!0,children:[t.jsx("h1",{className:"tacenter",children:"Оновлення даних"}),t.jsx("p",{className:"tacenter",children:"Ви можете оновити тільки назву, опис, оцінку та дату"}),t.jsx("p",{className:"tacenter",children:"Координати та погодні умови не змінюються"})]}):t.jsxs(c,{column:!0,center:!0,children:[t.jsx("h1",{className:"tacenter",children:"Створіть запис про рибалку"}),t.jsx("p",{children:"Додайте назву, опис, оцінку та дату"}),t.jsx("p",{className:"tacenter",children:"В описі, бажано, перерахувати що ловилося, та на що"}),t.jsxs("p",{className:"tacenter",children:["Опис бажано робити українською, ",t.jsx("br",{}),' щоб був коректний пошук ("короп", "товстолоб")']})]}),t.jsx("form",{onSubmit:g(e.data?L:S),className:"login__submitform",children:t.jsxs(c,{center:!0,column:!0,gap:25,children:[t.jsxs(c,{className:"login__submitform__input",column:!0,gap:10,children:[t.jsx(p,{id:"input_title_add",label:"Назва",...l("title"),error:m.title?.message}),t.jsx("p",{className:"addpage__descriptionarea",children:"Опис. Наишіть що ловили, на що, чим..."}),t.jsx(p,{id:"input_description_add",...l("description"),error:m.description?.message,as:"textarea",heightArea:170}),t.jsxs(c,{gap:10,children:[t.jsx(p,{id:"input_score_add",label:"Оцінка",type:"number",min:"0",max:"10",...l("score",{valueAsNumber:!0}),error:m.score?.message}),t.jsx(p,{ibackground:!0,id:"input_date_add",label:"Дата",type:"datetime-local",...l("date"),error:m.date?.message})]})]}),t.jsx(B,{isValid:N,type:"submit",appearence:"big",title:e.data?"ОНОВИТИ":"СТВОРИТИ"})]})}),t.jsx(c,{className:"addpage__back",onClick:()=>d(-1),children:t.jsx("h1",{children:t.jsx(Q,{name:"MdArrowBackIos"})})})]})})};export{z as default};
