import{u as L,a as N,b as H,c as K,r as b,j as t,F as r,P as M,M as R}from"./index-C_RLOzkS.js";import{F as U}from"./FadeIn-Bpd87IZF.js";import{u as P,I as c,g as D}from"./InputField-CJXRxfxq.js";import{o as V,s as u,n as F,u as B,a as W}from"./zod-RNXSzwHD.js";import{B as S}from"./Button-D8GDCmdP.js";import{f as A,Q as _}from"./constants-5KMCgFt6.js";/* empty css                  */const Y=V({title:u({required_error:"Назва є обов’язковою"}).min(2,"Назва є обов’язковим, не менше 3х символів"),description:u({required_error:"Опис є обов’язковим"}).min(4,"Опис є обов’язковим, не менше 10ти символів"),score:F({required_error:"Оцінка є обов’язковою",invalid_type_error:"Оцінка повинна бути числом"}).min(1,"Оцінка не може бути 0 мін. 1").max(10,"Оцінка не може бути більшою за 10"),date:u({required_error:"Дата є обов’язковою"}).min(8,"Дата є обов’язковою"),paidTitle:u(),paidPrise:F(),paidOwner:u(),paidContact:u()}),$=()=>{const l=L(),n=N(),e=P({mutationFn:A.create,onError:i=>{console.log(i)},onSuccess:i=>{l(`/details/${i._id}`),n.invalidateQueries({queryKey:[_.ALL_FISH]}),n.invalidateQueries({queryKey:[_.PAID]}),n.invalidateQueries({queryKey:[_.ALL_FISH_USER]}),n.invalidateQueries({queryKey:[_.ALL_FISH_FOR_MAP]})}});return{create:e.mutate,isLoading:e.isPending}},z=l=>{const n=P({mutationFn:A.update,onError:i=>{console.log(i)},onSuccess(i){e.setQueryData([_.ALL_FISH],s=>{if(!s)return s;const g=s?.pages.map(d=>({...d,data:d.data.map(p=>i._id===p._id?i:p)}));return{...s,pages:g}}),e.setQueryData([_.ALL_FISH_USER],s=>{if(!s)return s;const g=s?.pages.map(d=>({...d,data:d.data.map(p=>i._id===p._id?i:p)}));return{...s,pages:g}})}}),e=N();return{updete:n.mutate,isLoading:n.isPending}},m=l=>l.trim().replace(/\s+/g," "),ie=()=>{const l=L(),e=H().state,i=K(a=>a.auth.userInfo?.login),[s,g]=b.useState(),[d,p]=b.useState(!1),{create:I,isLoading:w}=$(),{updete:C,isLoading:q}=z(e.data?._id||""),T=async()=>{const a=e.position&&await D(e.position);g(a)};b.useEffect(()=>{!s&&T()},[]);const{register:o,handleSubmit:E,reset:y,formState:{errors:x,isValid:Q}}=B({resolver:W(Y),defaultValues:{title:e.data?e.data?.title:"",description:e.data?e.data?.description:"",score:e.data?e.data?.score:0,date:e.data?e.data?.date:"",paidTitle:e.data&&e.data.paid?e.data.paid?.title:"",paidOwner:e.data&&e.data.paid?e.data.paid?.owner:"",paidPrise:e.data&&e.data.paid?e.data.paid?.price:0,paidContact:e.data&&e.data.paid?e.data.paid?.contact.join(", "):""}}),v=async a=>{if(s&&e.position&&e.position.lat&&e.position.lng){const h={title:a.paidTitle,price:a.paidPrise,owner:a.paidOwner,contact:m(a.paidContact).split(", ")},j={title:m(a.title),description:m(a.description),score:a.score,date:a.date,coords:[e.position.lat,e.position.lng],img:[],weather:s,paid:i&&i==="admin"&&a.paidTitle!==""?h:void 0};I(j)}y()},O=async a=>{if(e.data){const h={title:a.paidTitle,price:a.paidPrise,owner:a.paidOwner,contact:m(a.paidContact).split(", ")},j={title:m(a.title),description:m(a.description),score:a.score,date:a.date,paid:i&&i==="admin"&&a.paidTitle!==""?h:void 0},f=e.data?._id||"",k={...e.data,...j};C({_id:f,payload:k}),l(`/details/${f}`)}y()};return t.jsx(U,{children:t.jsxs(r,{column:!0,centerV:!0,spredV:!0,className:"addpage",children:[e.data?t.jsxs(r,{column:!0,center:!0,children:[t.jsx("h1",{className:"tacenter",children:"Оновлення даних"}),t.jsx("p",{className:"tacenter",children:"Ви можете оновити тільки назву, опис, оцінку та дату"}),t.jsx("p",{className:"tacenter",children:"Координати та погодні умови не змінюються"})]}):t.jsxs(r,{column:!0,center:!0,children:[t.jsx("h1",{className:"tacenter",children:"Створіть запис про рибалку"}),t.jsx("p",{children:"Додайте назву, опис, оцінку та дату"}),t.jsx("p",{className:"tacenter",children:"В описі, бажано, перерахувати що ловилося, та на що"}),t.jsxs("p",{className:"tacenter",children:["Опис бажано робити українською, ",t.jsx("br",{}),' щоб був коректний пошук ("короп", "товстолоб")']})]}),t.jsxs("form",{onSubmit:E(e.data?O:v),className:"login__submitform addpage__submitform",children:[t.jsxs(r,{center:!0,column:!0,gap:25,children:[t.jsxs(r,{className:"login__submitform__input",column:!0,gap:10,children:[t.jsx(c,{id:"input_title_add",label:"Назва",...o("title"),error:x.title?.message}),t.jsx("p",{className:"addpage__descriptionarea",children:"Опис. Наишіть що ловили, на що, чим..."}),t.jsx(c,{id:"input_description_add",...o("description"),error:x.description?.message,as:"textarea",heightArea:170}),t.jsxs(r,{gap:10,children:[t.jsx(c,{id:"input_score_add",label:"Оцінка",type:"number",min:"0",max:"10",...o("score",{valueAsNumber:!0}),error:x.score?.message}),t.jsx(c,{ibackground:!0,id:"input_date_add",label:"Дата",type:"datetime-local",...o("date"),error:x.date?.message})]})]}),t.jsxs(r,{flex:!0,center:!0,gap:5,children:[t.jsx(S,{isValid:Q,type:"submit",appearence:"big",title:e.data?"ОНОВИТИ":"СТВОРИТИ"}),i==="admin"&&t.jsx(S,{type:"button",appearence:"big",title:"PAID",onClick:()=>p(!d)})]})]}),d&&t.jsxs(r,{absolute:!0,className:"addpage__paidform",column:!0,gap:10,children:[t.jsx(c,{id:"input_title_add_paid",label:"Точна назва місця",...o("paidTitle")}),t.jsx(c,{id:"input_price_add_paid",label:"Ціна",type:"number",...o("paidPrise",{valueAsNumber:!0})}),t.jsx(c,{id:"input_owner_add_paid",label:"Власник, або охоронець",...o("paidOwner")}),t.jsx(c,{id:"input_contact_add_paid",label:"Контактні дані (через кому ', ')",...o("paidContact")})]}),(q||w)&&t.jsx(r,{absolute:!0,className:"addpage__preloader",column:!0,gap:10,children:t.jsx(M,{})})]}),t.jsx(r,{className:"addpage__back",onClick:()=>l(-1),children:t.jsx("h1",{children:t.jsx(R,{name:"MdArrowBackIos"})})})]})})};export{ie as default};
