import{j as e,F as n,c as f,A as w,d as N,a as y,G as E,r as m,I as z,e as R,f as I,P as H,M as g,g as v,u as B,h as Q,i as K}from"./index-BOP0Ktq0.js";import{F as D}from"./FadeIn-CuNyybAP.js";import{B as _}from"./Button-DrK_FMmr.js";import{u as C,I as W,g as J}from"./InputField-Bn7E_P1t.js";import{Q as p,f as k}from"./constants-D0G4YQRr.js";import{S as Y,a as X}from"./swiper-SSNzxdxi.js";import{o as Z,s as ee,u as te,a as se}from"./inputtext-goDpqyah.js";import{u as F}from"./useQuery-dw0I-IqQ.js";import"./useBaseQuery-CfoLAxch.js";const O=({title:s,setDeleteItem:r,titleCheck:t,deleteItem:a,navigate:o})=>e.jsxs(n,{column:!0,gap:10,center:!0,className:"ckeckdelete",children:[e.jsx("p",{children:t}),s&&e.jsx("h4",{children:s}),e.jsxs(n,{gap:50,children:[e.jsx(_,{onClick:()=>{a(),o?.()},appearence:"big",title:"Так"}),e.jsx(_,{onClick:()=>r(!1),appearence:"big",title:"Ні"})]})]}),re=()=>e.jsx(n,{className:"detaisblur"});class ae{async uploadPhoto(r){try{return(await f.post(`${w.PHOTO.UPLOAD}${r._id}`,r.formData,{withCredentials:!1,headers:{"content-type":"multipart/form-data"}})).data}catch(t){throw t instanceof N?t.response?.data?new Error(t.response.data.message):new Error(t.message):new Error("Unexpected error")}}async getFotoInFolder(r){try{return(await f.get(`${w.PHOTO.DOWNLOAD}${r}`,{withCredentials:!1})).data}catch(t){throw t instanceof N?t.response?.data?new Error(t.response.data.message):new Error(t.message):new Error("Unexpected error")}}async deletePhoto(r){try{return(await f.post(w.PHOTO.DELETE,r,{withCredentials:!1})).data}catch(t){throw t instanceof N?t.response?.data?new Error(t.response.data.message):new Error(t.message):new Error("Unexpected error")}}}const b=new ae,ne=s=>{const r=y();return{uploadPhoto:C({mutationFn:b.uploadPhoto,onSuccess(){r.invalidateQueries({queryKey:[p.GET_ONE_FISHING,s]}),r.invalidateQueries({queryKey:[p.LOAD_PHOTO,s]})}}).mutateAsync}};function oe(s){return E({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"},child:[]}]})(s)}const ce=({data:s,setUploadPhoto:r})=>{const[t,a]=m.useState(null),[o,c]=m.useState(null),{uploadPhoto:d}=ne(s._id);function l(h){c(null),a(null);const u=h.target.files?Array.from(h.target.files):[];if(u[0]&&u[0].type!=="image/jpeg"&&u[0].type!=="image/png"){c("Файл має бути у форматі JPEG або PNG");return}a(u)}async function x(h){h.preventDefault();const u=new FormData;if(t&&t[0]&&t[0].type!=="image/jpeg"&&t[0].type!=="image/png"){c("Файл має бути у форматі JPEG або PNG");return}if(t){t.forEach(j=>{u.append("files",j,j.name)});try{await d({_id:s._id,formData:u}),a([]),r(!1)}catch(j){c(j?.response?.data?.message||j?.message)}}else c("ВИБЕРІТЬ ФОТО")}return e.jsxs(n,{column:!0,gap:10,centerV:!0,spredV:!0,className:"photoupload",children:[e.jsxs(n,{center:!0,column:!0,children:[e.jsx("h2",{children:"Завантажити фото"}),e.jsx("p",{children:"для запису:"}),e.jsxs("h4",{children:[" ",s.title]})]}),e.jsxs("form",{onSubmit:x,className:"photoupload__form",children:[e.jsx("label",{htmlFor:"upload",className:"photoupload__label",children:e.jsxs("h1",{children:[e.jsx(oe,{className:"glow"}),e.jsx(z,{className:"glow"}),e.jsx(R,{className:"glow"})]})}),e.jsx("input",{className:"photoupload__input",name:"upload",id:"upload",type:"file",multiple:!0,onChange:l}),e.jsxs(n,{gap:50,children:[e.jsx(_,{onClick:()=>r(!1),appearence:"big",title:"Відміна",type:"button"}),t&&e.jsx(_,{type:"submit",appearence:"big",title:"Завантажити"})]})]}),e.jsxs(n,{relativ:!0,className:"photoupload__imagebox",children:[t&&t.map((h,u)=>e.jsx("img",{src:URL.createObjectURL(h),alt:`preview-${u}`},u)),o&&e.jsx(n,{absolute:!0,flex:!0,center:!0,children:e.jsx("h4",{children:o})})]})]})},le=s=>{const r=y();return{deletePhoto:C({mutationFn:b.deletePhoto,onSuccess(){r.invalidateQueries({queryKey:[p.GET_ONE_FISHING,s]}),r.invalidateQueries({queryKey:[p.LOAD_PHOTO,s]})}}).mutateAsync}},ie=({fotoInFolder:s,data:r})=>{const[t,a]=m.useState(!1),o=m.useRef(null),c=I(l=>l.auth.userInfo?._id),{deletePhoto:d}=le(r._id);return m.useEffect(()=>{o.current&&(o.current.allowTouchMove=!t)},[t]),e.jsx("div",{className:"swiperpage",children:e.jsx(Y,{className:"swiperbox",spaceBetween:50,slidesPerView:1,onSwiper:l=>o.current=l,children:[...s].reverse().map((l,x)=>e.jsx(X,{className:"swiperpage__item",children:e.jsxs("div",{className:"swiperpage__picbox",children:[e.jsx("img",{className:"swiperpage__img",src:`${H}static/${r._id}/${l.originalname}`}),c===r.userId&&e.jsx("h1",{title:"видалити фото",onClick:()=>a(!0),className:"swiperpage__picbox__delete icomhover",children:e.jsx(g,{name:"MdDeleteForever"})}),t&&e.jsx(O,{deleteItem:()=>{d({photoId:l._id,setId:r._id}),a(!1)},setDeleteItem:a,titleCheck:"Ви дійсно хочете видалити це фото?"})]})},x))})})},de=()=>{const s=y(),r=C({mutationFn:k.deleteItem,onError:t=>{console.log(t)},onSuccess(t){s.setQueryData([p.ALL_FISH_USER],a=>{if(!a)return a;const o=a?.pages.map(c=>({...c,data:c.data.filter(d=>t._id!==d._id)}));return{...a,pages:o}}),s.setQueryData([p.ALL_FISH],a=>{if(!a)return a;const o=a?.pages.map(c=>({...c,data:c.data.filter(d=>t._id!==d._id)}));return{...a,pages:o}})}});return{deleteItem:r.mutate,isLoading:r.isPending}};class me{async create(r){try{return(await f.post(w.COMMENTS.CREATE,r,{withCredentials:!1})).data}catch(t){throw t instanceof N?t.response?.data?new Error(t.response.data.message):new Error(t.message):new Error("Unexpected error")}}async getAllByFishingId(r){try{return(await f.get(`${w.COMMENTS.GET}${r}`)).data}catch(t){throw t instanceof N?t.response?.data?new Error(t.response.data.message):new Error(t.message):new Error("Unexpected error")}}async deleteItem(r){try{return(await f.delete(`${w.COMMENTS.DELETE_ONE}${r}`)).data}catch(t){throw t instanceof N?t.response?.data?new Error(t.response.data.message):new Error(t.message):new Error("Unexpected error")}}}const M=new me,ue=s=>{const r=C({mutationFn:M.create,onError:d=>{console.log(d)}}),t=y(),{mutate:a,isPending:o}=r;return{create:d=>{a(d,{onSuccess(){t.invalidateQueries({queryKey:[p.GET_COMMENTS,s]})}})},isLoading:o}},he=Z({comment:ee({required_error:"Напишіть коментар"}).min(1,"Коментар, не менше 1го символа")}),pe=({data:s})=>{const{create:r}=ue(s._id),t=I(h=>h.auth?.userInfo),{register:a,handleSubmit:o,reset:c,formState:{errors:d,isValid:l}}=te({resolver:se(he),defaultValues:{comment:""}}),x=h=>{const u={login:t?.name,useId:t?._id,setId:s._id,comment:h.comment};r(u),c()};return e.jsxs(n,{column:!0,className:"addcomment",children:[e.jsx("h4",{className:"tacenter",children:"Напишіть коментар"}),e.jsxs("form",{onSubmit:o(x),children:[e.jsx(W,{id:"input_comment",...a("comment"),error:d.comment?.message,as:"textarea",heightArea:80}),t&&e.jsx(_,{className:"addcomment__btn",isValid:l,type:"submit",appearence:"big",title:"відправити"})]})]})};function xe(s){const r=s.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})/);if(!r)return"";const[,t,a,o,c,d]=r;return`${+c+3}:${d} ${o}/${a}/${t}`}const je=s=>{const r=y();return{deleteComment:C({mutationFn:M.deleteItem,onSuccess(){r.invalidateQueries({queryKey:[p.GET_COMMENTS,s]})}}).mutateAsync}},ge=({setDeleteItem:s,titleCheck:r,deleteItem:t})=>e.jsxs(n,{gap:25,center:!0,className:"ckeckdeletecomment",children:[e.jsx(_,{onClick:()=>s(!1),appearence:"small",title:"Ні"}),e.jsx("p",{className:"tacenter",children:r}),e.jsx(_,{onClick:()=>{t()},appearence:"small",title:"Так"})]}),_e=m.memo(({data:s,userId:r})=>{const{deleteComment:t}=je(s.setId),[a,o]=m.useState(!1);return e.jsxs(n,{spredV:!0,className:"commentcard_wrapper",children:[e.jsxs(n,{className:"commentcard",children:[e.jsx("p",{children:s.comment}),e.jsx(n,{className:"commentcard__name",children:e.jsx("p",{children:s.login})}),e.jsx(n,{className:"commentcard__date",children:e.jsx("p",{children:xe(s.createdAt)})})]}),r===s.useId&&e.jsx("h1",{onClick:()=>o(!0),className:"commentcard__delete",children:e.jsx(g,{name:"MdDeleteForever"})}),a&&e.jsx(ge,{titleCheck:"видалити коментар?",setDeleteItem:o,deleteItem:()=>t(s._id)})]})});function fe(s,r=[]){m.useEffect(()=>{s?.current?.scrollIntoView({behavior:"smooth"})},r)}const we=m.memo(({data:s,label:r,isLoading:t})=>{const a=I(c=>c.auth.userInfo?._id),o=m.useRef(null);return fe(o,[s]),e.jsxs("div",{className:"listwrapper",children:[r&&e.jsx("h4",{className:"list__label",children:r}),e.jsxs("div",{className:"list",children:[!s?.length&&e.jsxs(n,{column:!0,flex:!0,center:!0,children:[e.jsx("p",{children:"Коментарі відсутні"}),e.jsx("p",{children:"Напишіть коментар для цього запису"})]}),s&&s.map(c=>e.jsx(_e,{userId:a,data:c},c._id)),t&&e.jsx("div",{className:"listwrapper__loader",children:e.jsx(v,{})}),e.jsx("div",{ref:o,style:{height:"0px",marginTop:"-1px"}})]})]})});function Ne(s){return E({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm52.7 283.3L256 278.6l-52.7 52.7c-6.2 6.2-16.4 6.2-22.6 0-3.1-3.1-4.7-7.2-4.7-11.3 0-4.1 1.6-8.2 4.7-11.3l52.7-52.7-52.7-52.7c-3.1-3.1-4.7-7.2-4.7-11.3 0-4.1 1.6-8.2 4.7-11.3 6.2-6.2 16.4-6.2 22.6 0l52.7 52.7 52.7-52.7c6.2-6.2 16.4-6.2 22.6 0 6.2 6.2 6.2 16.4 0 22.6L278.6 256l52.7 52.7c6.2 6.2 6.2 16.4 0 22.6-6.2 6.3-16.4 6.3-22.6 0z"},child:[]}]})(s)}const ye=({setComments:s,data:r,comments:t,isLoading:a})=>e.jsxs(n,{column:!0,gap:10,centerV:!0,spredV:!0,className:"comments",children:[e.jsxs(n,{className:"comments__header",centerV:!0,spredV:!0,children:[e.jsx("h3",{children:"КОМЕНТАРІ ДО РИБАЛКИ"}),e.jsx("h1",{className:"icomhover",onClick:()=>s(!1),children:e.jsx(Ne,{})})]}),e.jsx(n,{className:"comments__list",children:e.jsx(we,{data:[...t??[]].reverse(),isLoading:a})}),e.jsx(pe,{data:r})]});function Ce(s){return E({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M16 8c0 3.866-3.582 7-8 7a9 9 0 0 1-2.347-.306c-.584.296-1.925.864-4.181 1.234-.2.032-.352-.176-.273-.362.354-.836.674-1.95.77-2.966C.744 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7M4.5 5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1zm0 2.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1zm0 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1z"},child:[]}]})(s)}const Ee=s=>{const{data:r,isError:t,error:a,isLoading:o}=F({queryKey:[p.GET_COMMENTS,s],queryFn:()=>M.getAllByFishingId(s),enabled:!!s});return{comments:r,isError:t,error:a,isLoading:o}},Ie=s=>{const{data:r,isError:t,error:a}=F({queryKey:[p.GET_ONE_FISHING,s],queryFn:()=>k.getOne(s),enabled:!!s});return{data:r,isError:t,error:a}},Se=s=>{const{data:r,isLoading:t}=F({queryKey:[p.LOAD_PHOTO,s],queryFn:()=>b.getFotoInFolder(s),enabled:!!s});return{photoData:r,isLoadingPhoto:t}};function Pe(s){return E({attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M14.5 3l-1 3-1-3c-.184-.553.114-1.149.666-1.333.553-.185 1.15.114 1.334.666.075.226.07.458 0 .667zM19.864 6.05l-2.829 1.415 1.415-2.829c.261-.521.894-.731 1.414-.472.521.261.731.894.472 1.415-.107.212-.274.372-.472.471zM21.5 12l-3-1 3-1c.553-.185 1.149.114 1.334.667.184.552-.115 1.148-.668 1.333-.225.075-.457.069-.666 0zM8.55 4.636l1.415 2.829-2.829-1.415c-.521-.261-.732-.894-.472-1.414.261-.521.895-.731 1.414-.472.213.107.373.274.472.472zM17.776 12.342c.139-.424.224-.871.224-1.342 0-2.481-2.019-4.5-4.5-4.5-1.34 0-2.537.594-3.357 1.528l-.143-.028c-1.776 0-3.369.78-4.469 2.011-.24-.08-.472-.086-.697-.011-.553.185-.852.781-.668 1.333.057.167.158.299.277.411-.283.697-.443 1.458-.443 2.256l.002.126c-1.725.445-3.002 2.013-3.002 3.874 0 2.206 1.795 4 4 4h11c2.757 0 5-2.243 5-5 0-2.129-1.344-3.939-3.224-4.658zm-4.276-3.842c1.379 0 2.5 1.121 2.5 2.5 0 .366-.096.706-.238 1.019-.354.021-.72.074-1.118.188-.521-1.353-1.604-2.415-2.967-2.905.456-.49 1.102-.802 1.823-.802zm2.5 11.5h-11c-1.104 0-2-.897-2-2s.896-2 1.908-2.006l1.422.016-.248-1.202c-.055-.263-.082-.536-.082-.808 0-2.206 1.795-4 4-4l.069-.014c1.904.055 3.495 1.406 3.847 3.27l.038.186c.123.436.517.706.946.712l.289-.023c.312-.09.569-.131.811-.131 1.654 0 3 1.346 3 3s-1.346 3-3 3z"},child:[]}]}]})(s)}const ve=({data:s,coords:r,setWeatherView:t})=>{const[a,o]=m.useState(),c=async l=>{const x=await J(l);o(x)};m.useEffect(()=>{s&&o(s),r&&c(r)},[s,r]);let d;if(a){const l=a.deg;(l>=0&&l<=45||l>=320&&l<=360)&&(d="Північний"),l>=46&&l<=130&&(d="Східний"),l>=131&&l<=230&&(d="Південний"),l>=231&&l<=319&&(d="Західний")}return e.jsx(D,{onClick:()=>t(!1),className:"weather",children:e.jsxs(n,{gap:8,column:!0,center:!0,children:[e.jsx("h3",{className:"tacenter upper",children:"погода на момент створення запису"}),e.jsxs(n,{className:"weather__content",gap:5,column:!0,children:[e.jsxs("p",{children:[" ",a?.sky.toUpperCase()," "]}),e.jsxs("p",{children:[e.jsx("span",{children:"Tемпература:"})," ",a?.temp," °C"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Вологість:"})," ",a?.humidity," %"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Тиск:"})," ",a?.grnd_level," hPa"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Вітер:"})," ",d," ",a?.speed," м/с"]})]}),e.jsxs("p",{className:"tacenter",children:["⚠ данні атоматично встановлюються ",e.jsx("br",{}),"під час створення запису, ",e.jsx("br",{}),"за координатами вибраними на мапі"]})]})})},Ge=()=>{const s=B(),r=I(U=>U.auth.userInfo?._id),{id:t}=Q(),[a,o]=m.useState(!1),[c,d]=m.useState(!1),[l,x]=m.useState(!1),[h,u]=m.useState(!1),[j,A]=m.useState(),{deleteItem:L}=de(),{data:i,isError:G,error:$}=Ie(t),{photoData:T,isLoadingPhoto:V}=Se(t),{comments:S,isLoading:q}=Ee(i?._id);m.useEffect(()=>{setTimeout(()=>{A(T)},500)},[T]);const P=i?.date.slice(0,10).split("-");return e.jsx(D,{children:e.jsxs(n,{relativ:!0,column:!0,centerV:!0,spredH:!0,gap:10,className:"datails",children:[G&&e.jsx("h2",{children:$?.message}),i?e.jsxs(n,{className:"datails__content",column:!0,children:[e.jsxs(n,{centerV:!0,spredV:!0,className:"datails__author",children:[e.jsxs("p",{className:"upper",children:["USER: ",i.userName]}),e.jsx("h1",{className:"icomhover",onClick:()=>s(-1),children:e.jsx(g,{name:"MdArrowBackIos"})})]}),e.jsx("h4",{className:"upper",children:i.title}),e.jsx(n,{column:!0,className:"datails__content__description",children:e.jsx("p",{children:i.description})}),e.jsxs(n,{className:"datails__content__footer",spredV:!0,gap:10,children:[e.jsxs("p",{children:["Дата: ",P?.[2]," / ",P?.[1]," /",P?.[0]]}),e.jsx("h2",{onClick:()=>u(!h),title:"погода",className:"datails__content__weather",children:e.jsx(Pe,{})}),e.jsxs("p",{children:["Оцінка: ",i.score]})]}),e.jsxs(n,{className:"datails__content__buttonbar",spredV:!0,gap:10,children:[e.jsx("a",{className:"googlelink",href:`https://www.google.com/maps?ll=${i.coords[0]},${i.coords[1]}&q=${i.coords[0]},${i.coords[1]}`,target:"_blank",children:e.jsxs(n,{centerV:!0,row:!0,children:[e.jsx("h1",{className:"icomhover",children:e.jsx(g,{name:"MdLocationPin"})}),e.jsx("p",{children:"Google Map Link"})]})}),e.jsx(n,{title:"показати на мапі",onClick:()=>s("/mappage",{state:{oneFishing:i}}),center:!0,className:"datails__content__viewmap",children:e.jsx("h1",{className:"icomhover",children:e.jsx(K,{className:"grad"})})}),e.jsxs(n,{title:"коментарі",onClick:()=>x(!0),center:!0,className:"datails__content__comments",children:[e.jsx("h1",{className:"icomhover",children:e.jsx(Ce,{})}),S?.length&&e.jsx("p",{children:S?.length})]}),r===i?.userId&&e.jsxs(n,{className:"datails__content__buttonbar__btn",gap:20,children:[e.jsx("h1",{className:"icomhover",title:"загрузити фото",onClick:()=>d(!0),children:e.jsx(g,{name:"MdAddPhotoAlternate"})}),e.jsx("h1",{className:"icomhover",title:"оновити дані",onClick:()=>s("/addpage",{state:{data:i}}),children:e.jsx(g,{name:"MdOutlineUpdate"})}),e.jsx("h1",{className:"icomhover",title:"видалити",onClick:()=>o(!0),children:e.jsx(g,{name:"MdDeleteForever"})})]})]})]}):e.jsx(v,{}),(a||c||l)&&e.jsx(re,{}),e.jsx(n,{center:!0,className:"datails__photobox",children:j?.length&&i?e.jsx(ie,{fotoInFolder:j,data:i}):V?e.jsx(v,{}):e.jsx(n,{center:!0,flex:!0,children:r===i?.userId?e.jsxs(n,{onClick:()=>d(!0),column:!0,center:!0,children:[e.jsx("h1",{className:"icomhover",title:"загрузити фото",children:e.jsx(g,{name:"MdAddPhotoAlternate"})}),e.jsxs("h4",{className:"tacenter",children:["Ще немає фото.",e.jsx("br",{}),"Натисніть щоб загрузити свой фото,",e.jsx("br",{}),"для цієї рибалки"]})]}):e.jsx(n,{column:!0,center:!0,children:e.jsx("h4",{children:"Автор ще не додав сюди фото"})})})}),a&&i&&e.jsx(O,{deleteItem:()=>L(i?._id),navigate:()=>s("/mypage"),title:i.title,setDeleteItem:o,titleCheck:"Ви дійсно хочете видалити запис:"}),c&&i&&e.jsx(ce,{data:i,setUploadPhoto:d}),l&&i&&e.jsx(ye,{comments:S,isLoading:q,data:i,setComments:x}),h&&i&&e.jsx(ve,{setWeatherView:u,data:i.weather})]})})};export{Ge as default};
