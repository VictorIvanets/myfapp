import{u as N,a as w,n as A,b as U,c as B,r as f,j as t,F as n,P as D,M as V}from"./index-DGztJ_8H.js";import{F as $}from"./FadeIn-DVAY6-68.js";import{g as W}from"./getWeather-BGrkt0Ry.js";import{o as Y,s as _,n as P,u as z,a as G}from"./zod-Bfc4r9zr.js";import{B as L}from"./Button-CCs2UZWN.js";import{u as I,t as C,a as q,l as E,I as c}from"./loadBarProps-DLlRE3q5.js";import{f as T}from"./fishing.services-DOcKL203.js";import{Q as x}from"./constants-BM5sXqWl.js";/* empty css                  */const J=Y({title:_({required_error:"Назва є обов’язковою"}).min(2,"Назва є обов’язковим, не менше 3х символів"),description:_({required_error:"Опис є обов’язковим"}).min(4,"Опис є обов’язковим, не менше 10ти символів"),score:P({required_error:"Оцінка є обов’язковою",invalid_type_error:"Оцінка повинна бути числом"}).min(1,"Оцінка не може бути 0 мін. 1").max(10,"Оцінка не може бути більшою за 10"),date:_({required_error:"Дата є обов’язковою"}).min(8,"Дата є обов’язковою"),paidTitle:_(),paidPrise:P(),paidOwner:_(),paidContact:_()}),X=()=>{const l=N(),p=w(),{start:e,complete:r}=A(E),d=I({mutationFn:async i=>(e(),await T.create(i)),onError:i=>{r(),q({message:i.message})},onSuccess:i=>{C({message:`Запис ${i.title} додано`}),r(),l(`/details/${i._id}`),p.invalidateQueries({queryKey:[x.ALL_FISH]}),p.invalidateQueries({queryKey:[x.PAID]}),p.invalidateQueries({queryKey:[x.ALL_FISH_USER]}),p.invalidateQueries({queryKey:[x.ALL_FISH_FOR_MAP]})}});return{create:d.mutate,isLoading:d.isPending}},Z=l=>{const{start:p,complete:e}=A(E),r=I({mutationFn:async i=>(p(),await T.update(i)),onError:i=>{e(),q({message:i.message})},onSuccess(i){C({message:`Запис ${i.title} оновлено`}),e(),d.setQueryData([x.ALL_FISH],s=>{if(!s)return s;const h=s?.pages.map(u=>({...u,data:u.data.map(m=>i._id===m._id?i:m)}));return{...s,pages:h}}),d.setQueryData([x.ALL_FISH_USER],s=>{if(!s)return s;const h=s?.pages.map(u=>({...u,data:u.data.map(m=>i._id===m._id?i:m)}));return{...s,pages:h}})}}),d=w();return{updete:r.mutate,isLoading:r.isPending}},g=l=>l.trim().replace(/\s+/g," "),ce=()=>{const l=N(),e=U().state,r=B(a=>a.auth.userInfo?.login),[d,i]=f.useState(),[s,h]=f.useState(!1),{create:u,isLoading:m}=X(),{updete:Q,isLoading:v}=Z(e.data?._id||""),O=async()=>{const a=e.position&&await W(e.position);i(a)};f.useEffect(()=>{!d&&O()},[]);const{register:o,handleSubmit:k,reset:F,formState:{errors:j,isValid:H}}=z({resolver:G(J),defaultValues:{title:e.data?e.data?.title:"",description:e.data?e.data?.description:"",score:e.data?e.data?.score:0,date:e.data?e.data?.date:"",paidTitle:e.data&&e.data.paid?e.data.paid?.title:"",paidOwner:e.data&&e.data.paid?e.data.paid?.owner:"",paidPrise:e.data&&e.data.paid?e.data.paid?.price:0,paidContact:e.data&&e.data.paid?e.data.paid?.contact.join(", "):""}}),K=async a=>{if(d&&e.position&&e.position.lat&&e.position.lng){const b={title:a.paidTitle,price:a.paidPrise,owner:a.paidOwner,contact:g(a.paidContact).split(", ")},y={title:g(a.title),description:g(a.description),score:a.score,date:a.date,coords:[e.position.lat,e.position.lng],img:[],weather:d,paid:r&&r==="admin"&&a.paidTitle!==""?b:void 0};u(y)}F()},M=async a=>{if(e.data){const b={title:a.paidTitle,price:a.paidPrise,owner:a.paidOwner,contact:g(a.paidContact).split(", ")},y={title:g(a.title),description:g(a.description),score:a.score,date:a.date,paid:r&&r==="admin"&&a.paidTitle!==""?b:void 0},S=e.data?._id||"",R={...e.data,...y};Q({_id:S,payload:R}),l(`/details/${S}`)}F()};return t.jsx($,{children:t.jsxs(n,{column:!0,centerV:!0,spredV:!0,className:"addpage",children:[e.data?t.jsxs(n,{column:!0,center:!0,children:[t.jsx("h1",{className:"tacenter",children:"Оновлення даних"}),t.jsx("p",{className:"tacenter",children:"Ви можете оновити тільки назву, опис, оцінку та дату"}),t.jsx("p",{className:"tacenter",children:"Координати та погодні умови не змінюються"})]}):t.jsxs(n,{column:!0,center:!0,children:[t.jsx("h1",{className:"tacenter",children:"Створіть запис про рибалку"}),t.jsx("p",{children:"Додайте назву, опис, оцінку та дату"}),t.jsx("p",{className:"tacenter",children:"В описі, бажано, перерахувати що ловилося, та на що"}),t.jsxs("p",{className:"tacenter",children:["Опис бажано робити українською, ",t.jsx("br",{}),' щоб був коректний пошук ("короп", "товстолоб")']})]}),t.jsxs("form",{onSubmit:k(e.data?M:K),className:"login__submitform addpage__submitform",children:[t.jsxs(n,{center:!0,column:!0,gap:25,children:[t.jsxs(n,{className:"login__submitform__input",column:!0,gap:10,children:[t.jsx(c,{id:"input_title_add",label:"Назва",...o("title"),error:j.title?.message}),t.jsx("p",{className:"addpage__descriptionarea",children:"Опис. Наишіть що ловили, на що, чим..."}),t.jsx(c,{id:"input_description_add",...o("description"),error:j.description?.message,as:"textarea",heightArea:170}),t.jsxs(n,{gap:10,children:[t.jsx(c,{id:"input_score_add",label:"Оцінка",type:"number",min:"0",max:"10",...o("score",{valueAsNumber:!0}),error:j.score?.message}),t.jsx(c,{ibackground:!0,id:"input_date_add",label:"Дата",type:"datetime-local",...o("date"),error:j.date?.message})]})]}),t.jsxs(n,{flex:!0,center:!0,gap:5,children:[t.jsx(L,{isValid:H,type:"submit",appearence:"big",title:e.data?"ОНОВИТИ":"СТВОРИТИ"}),r==="admin"&&t.jsx(L,{type:"button",appearence:"big",title:"PAID",onClick:()=>h(!s)})]})]}),s&&t.jsxs(n,{absolute:!0,className:"addpage__paidform",column:!0,gap:10,children:[t.jsx(c,{id:"input_title_add_paid",label:"Точна назва місця",...o("paidTitle")}),t.jsx(c,{id:"input_price_add_paid",label:"Ціна",type:"number",...o("paidPrise",{valueAsNumber:!0})}),t.jsx(c,{id:"input_owner_add_paid",label:"Власник, або охоронець",...o("paidOwner")}),t.jsx(c,{id:"input_contact_add_paid",label:"Контактні дані (через кому ', ')",...o("paidContact")})]}),(v||m)&&t.jsx(n,{absolute:!0,className:"addpage__preloader",column:!0,gap:10,children:t.jsx(D,{})})]}),t.jsx(n,{className:"addpage__back",onClick:()=>l(-1),children:t.jsx("h1",{children:t.jsx(V,{name:"MdArrowBackIos"})})})]})})};export{ce as default};
