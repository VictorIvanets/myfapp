import{G as R,j as t,F as i,d as x,A as E,e as _,a as j,r as d,M as A,c as S,P as b,n as I,m as Y,t as W,o as X}from"./index-DGztJ_8H.js";import{F as K}from"./FadeIn-DVAY6-68.js";import{I as k}from"./InputText-DrMggox2.js";import{n as D,C as $}from"./CkeckDeleteComment-Cf_fmXip.js";import{B as f}from"./Button-CCs2UZWN.js";import{u as y,a as N,I as L,l as G,t as M}from"./loadBarProps-DLlRE3q5.js";import{Q as h}from"./constants-BM5sXqWl.js";import{u as z}from"./useQuery-BgDqM79t.js";import{o as B,s as O,u as q,a as U}from"./zod-Bfc4r9zr.js";import{u as F,a as H}from"./useDebounce-BbGGsUUV.js";import{S as J}from"./SwipeTabs-Bj1YaSKy.js";/* empty css                  */import"./useBaseQuery-6UluQ36d.js";import"./swiper-DEbmr42G.js";var o=(e=>(e.MAIN="#101010",e.MAIN50="#1010107c",e.MAIN20="#10101038",e.TEXT="#cacaca",e.TEXTDARK="#747474ff",e.SECOND="#313131",e.SECOND50="#31313183",e.SECOND20="#3131313a",e.ACCENT="#008394",e.ACCENT50="#00839480",e.WHITE="#eeeeee",e.BLUE="#003546",e.BLUE50="#0035467a",e.RED="#ff583bff",e.ORANGE="#832900",e))(o||{});const Z={TEXT:"#cacaca"},ee={red:{background:o.RED,text:o.WHITE},blue:{background:o.ACCENT,text:o.TEXT},black:{background:o.MAIN,text:o.TEXT},textgray:{background:o.SECOND,text:o.WHITE},gray:{background:o.SECOND,text:o.WHITE},green:{background:o.TEXT,text:o.ACCENT},white:{background:o.WHITE,text:o.RED},orange:{background:o.ORANGE,text:o.WHITE}};function te(e){return ee[e]}var Q=(e=>(e.RED="red",e.BLUE="blue",e.BLACK="black",e.GRAY="gray",e.TEXTGRAY="textgray",e.GREEN="green",e.WHITE="white",e.ORANGE="orange",e))(Q||{});const re=[{name:"textgray",background:o.WHITE,text:o.SECOND},{name:"blue",background:o.ACCENT,text:o.TEXT},{name:"black",background:o.MAIN,text:o.TEXT},{name:"gray",background:o.SECOND,text:o.WHITE},{name:"green",background:o.TEXT,text:o.ACCENT},{name:"white",background:o.WHITE,text:o.RED},{name:"red",background:o.RED,text:o.WHITE},{name:"orange",background:o.ORANGE,text:o.WHITE}];function se(e){return R({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7 7h10v2H7zm0 4h7v2H7z"},child:[]},{tag:"path",attr:{d:"M20 2H4c-1.103 0-2 .897-2 2v18l5.333-4H20c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2zm0 14H6.667L4 18V4h16v12z"},child:[]}]})(e)}const ae=({setDeleteItem:e,titleCheck:s,deleteItem:r})=>t.jsxs(i,{gap:25,center:!0,className:"ckeckdeletecomment",children:[t.jsx(f,{onClick:()=>e(!1),appearence:"small",title:"Ні"}),t.jsx("p",{className:"tacenter",children:s}),t.jsx(f,{onClick:()=>{r(),e(!1)},appearence:"small",title:"Так"})]});class ne{async create(s){try{return(await x.post(E.COMMENTS_POSTS.CREATE,s)).data}catch(r){throw r instanceof _?r.response?.data?new Error(r.response.data.message):new Error(r.message):new Error("Unexpected error")}}async getAllByPostId(s){try{return(await x.get(`${E.COMMENTS_POSTS.GET_ALL_BY_POST_ID}${s}`)).data}catch(r){throw r instanceof _?r.response?.data?new Error(r.response.data.message):new Error(r.message):new Error("Unexpected error")}}async deleteComment({commentId:s,postId:r}){try{return(await x.delete(E.COMMENTS_POSTS.DELETE_ONE,{params:{commentId:s,postId:r}})).data}catch(a){throw a instanceof _?a.response?.data?new Error(a.response.data.message):new Error(a.message):new Error("Unexpected error")}}}const v=new ne,oe=e=>{const s=j(),r=y({mutationFn:v.deleteComment,onSuccess(){s.invalidateQueries({queryKey:[h.POST_GET_ALL]}),s.invalidateQueries({queryKey:[h.POST_COMMENTS_GET_ALL_BY_POST,e]}),s.invalidateQueries({queryKey:[h.POST_GET_ONE,e]}),s.invalidateQueries({queryKey:[h.POST_GET_ALL_BY_USER]})},onError:a=>{N({message:a.message})}});return{deleteComment:r.mutateAsync,isLoading:r.isPending}},ce=d.memo(({data:e,userId:s,postId:r})=>{const{deleteComment:a,isLoading:n}=oe(r),[c,l]=d.useState(!1);return t.jsxs(i,{className:"postcommentcard_wrapper",children:[t.jsxs(i,{flex:!0,className:"postcommentcard",children:[t.jsx("p",{children:e.comment}),t.jsxs(i,{gap:5,className:"postcommentcard__name",children:[t.jsx("p",{children:e.login})," ",t.jsx("p",{children:D(e.createdAt)})]})]}),!n&&s===e.useId&&t.jsx("h1",{onClick:()=>l(!0),className:"postcommentcard__delete",children:t.jsx(A,{name:"MdDeleteForever"})}),n&&s===e.useId&&t.jsx("h1",{className:"postcommentcard__delete",children:t.jsx(A,{name:"MdAutoDelete"})}),c&&t.jsx(ae,{titleCheck:"видалити коментар?",setDeleteItem:l,deleteItem:()=>a({commentId:e._id,postId:r})})]})}),ie=e=>{const{data:s,isError:r,error:a,isLoading:n,refetch:c}=z({queryKey:[h.POST_COMMENTS_GET_ALL_BY_POST,e],queryFn:()=>v.getAllByPostId(e),enabled:!!e});return{comments:s||[],isError:r,error:a,isLoading:n,refetch:c}},le=B({comment:O({required_error:"Напишіть коментар"}).min(1,"Коментар, не менше 1го символа")}),ue=()=>{const e=y({mutationFn:v.create,onError:c=>{N({message:c.message})}}),s=j(),{mutate:r,isPending:a}=e;return{create:c=>{r(c,{onSuccess(){s.invalidateQueries({queryKey:[h.POST_COMMENTS_GET_ALL_BY_POST,c.postId]}),s.invalidateQueries({queryKey:[h.POST_GET_ONE,c.postId]}),s.invalidateQueries({queryKey:[h.POST_GET_ALL]}),s.invalidateQueries({queryKey:[h.POST_GET_ALL_BY_USER]})}})},isLoading:a}},me=({data:e})=>{const{create:s}=ue(),r=S(m=>m.auth?.userInfo),{register:a,handleSubmit:n,reset:c,formState:{errors:l,isValid:u}}=q({resolver:U(le),defaultValues:{comment:""}}),p=m=>{const T={postId:e._id,comment:m.comment};s(T),c()};return t.jsxs(i,{column:!0,className:"addpostcomment",children:[t.jsx("h4",{className:"tacenter",children:"Напишіть коментар"}),t.jsxs("form",{onSubmit:n(p),children:[t.jsx(L,{id:"input_comment",...a("comment"),error:l.comment?.message,as:"textarea",heightArea:50}),r&&t.jsx(f,{className:"addpostcomment__btn",isValid:u,type:"submit",appearence:"big",title:"відправити"})]})]})},de=({data:e})=>{const s=S(n=>n.auth.userInfo?._id),{comments:r,isLoading:a}=ie(e._id);return t.jsxs(i,{column:!0,gap:10,className:"commentspost",children:[t.jsxs(i,{column:!0,children:[!a&&!r?.length&&t.jsxs(i,{column:!0,flex:!0,center:!0,children:[t.jsx("p",{children:"Коментарі відсутні. Напишіть коментар для цього запису"}),t.jsx("p",{})]}),a&&t.jsx(b,{}),!a&&r&&[...r].reverse().map(n=>t.jsx(ce,{postId:e._id,userId:s,data:n},n._id))]}),t.jsx(me,{data:e})]})};class pe{async create(s){try{return(await x.post(E.POSTS.CREATE,s)).data}catch(r){throw r instanceof _?r.response?.data?new Error(r.response.data.message):new Error(r.message):new Error("Unexpected error")}}async getOne(s){try{return(await x.get(`${E.POSTS.GET_ONE_BY_ID}${s}`)).data}catch(r){throw r instanceof _?r.response?.data?new Error(r.response.data.message):new Error(r.message):new Error("Unexpected error")}}async getAll(s,r,a=5){try{return(await x.get(E.POSTS.GET_ALL,{params:{cursor:s,limit:a,description:r}})).data}catch(n){throw n instanceof _?n.response?.data?new Error(n.response.data.message):new Error(n.message):new Error("Unexpected error")}}async getAllByUser(s,r,a=4){try{return(await x.get(E.POSTS.GET_ALL_BY_USER,{params:{cursor:s,limit:a,description:r}})).data}catch(n){throw n instanceof _?n.response?.data?new Error(n.response.data.message):new Error(n.message):new Error("Unexpected error")}}async deleteById(s){try{return(await x.delete(`${E.POSTS.DELETE_ONE}${s}`)).data}catch(r){throw r instanceof _?r.response?.data?new Error(r.response.data.message):new Error(r.message):new Error("Unexpected error")}}}const P=new pe,he=()=>{const e=j(),{start:s,complete:r}=I(G),a=y({mutationFn:async n=>(s(),await P.deleteById(n)),onError:n=>{r(),N({message:n.message})},onSuccess(){r(),M({message:"Запис видалено"}),e.invalidateQueries({queryKey:[h.POST_GET_ALL]}),e.invalidateQueries({queryKey:[h.POST_GET_ALL_BY_USER]})}});return{deletePost:a.mutate,isLoading:a.isPending}},ge=({data:e})=>{const{background:s,text:r}=te(e.colorSchema),a=S(T=>T.auth.userInfo?._id),[n,c]=d.useState(!1),[l,u]=d.useState(!1),{deletePost:p,isLoading:m}=he();return t.jsxs(i,{column:!0,center:!0,className:"postcardwrwpper",children:[t.jsx("div",{style:{backgroundColor:s},className:"postcard",children:t.jsx("h1",{style:{color:r},children:e.description})}),t.jsxs(i,{centerV:!0,flex:!0,spredV:!0,className:"postcard__footer",children:[t.jsxs("p",{children:["Додав: ",e.userLogin]}),t.jsxs(i,{onClick:()=>c(!n),className:"postcard__comment",gap:4,children:[t.jsx("p",{children:e.commentCount}),t.jsx(se,{color:Z.TEXT,size:15})]}),t.jsx("p",{children:D(e.createdAt)}),a===e.userId&&t.jsx(f,{disabled:m,onClick:()=>u(!0),title:"delete"})]}),l&&t.jsx($,{titleCheck:"видалити запис?",setDeleteItem:u,deleteItem:()=>p(e._id)}),n&&e&&t.jsx(de,{data:e})]})},V=d.memo(({data:e,label:s,hasNextPage:r,fetchNextPage:a,isLoading:n,isFetchingNextPage:c})=>{const l=d.useRef(null);return d.useEffect(()=>{if(!r||!a)return;const u=new IntersectionObserver(p=>{p[0].isIntersecting&&a()},{threshold:1});return l.current&&u.observe(l.current),()=>{l.current&&u.unobserve(l.current)}},[r,a]),t.jsxs("div",{className:"postlistwrapper",children:[s&&t.jsx("h4",{className:"postlist__label",children:s}),t.jsxs("div",{className:"postlist",children:[e.map(u=>t.jsx(ge,{data:u},u._id)),(n||c)&&t.jsx("div",{className:"postlistwrapper__loader",children:t.jsx(b,{})}),r&&t.jsx("div",{ref:l,style:{height:"1px",marginTop:"-1px"}})]})]})}),xe=()=>{const[e,s]=d.useState(),r=F(e,500),{data:a,isLoading:n,isError:c,error:l,fetchNextPage:u,hasNextPage:p,isFetchingNextPage:m,isRefetching:T,refetch:w}=H({queryKey:[h.POST_GET_ALL,r],queryFn:({pageParam:g})=>P.getAll(g,r),getNextPageParam:g=>g.nextCursor??void 0,initialPageParam:void 0}),C=a?.pages.flatMap(g=>g.data)||[];return{isLoading:n,isError:c,error:l,fetchNextPage:u,hasNextPage:p,isFetchingNextPage:m,posts:C,isRefetching:T,refetchData:w,valueDescription:e,setValueDescription:s}},Ee=d.memo(()=>{const{isLoading:e,isError:s,error:r,fetchNextPage:a,hasNextPage:n,isFetchingNextPage:c,posts:l,valueDescription:u,setValueDescription:p}=xe();return t.jsx(t.Fragment,{children:t.jsx(i,{centerH:!0,className:"allpost",children:t.jsxs(i,{column:!0,className:"allpost__list",children:[t.jsx(k,{value:u,onChange:m=>p(m.target.value),id:"input_descriptoin_search",label:"Пошук",searchLabel:!0}),t.jsx(V,{hasNextPage:n,fetchNextPage:a,isLoading:e,isFetchingNextPage:c,data:l}),s&&t.jsx("h4",{children:r?.message})]})})})}),_e=()=>{const[e,s]=d.useState(),r=F(e,500),{data:a,isLoading:n,isError:c,error:l,fetchNextPage:u,hasNextPage:p,isFetchingNextPage:m,isRefetching:T,refetch:w}=H({queryKey:[h.POST_GET_ALL_BY_USER,r],queryFn:({pageParam:g})=>P.getAllByUser(g,r),getNextPageParam:g=>g.nextCursor??void 0,initialPageParam:void 0}),C=a?.pages.flatMap(g=>g.data)||[];return{isLoading:n,isError:c,error:l,fetchNextPage:u,hasNextPage:p,isFetchingNextPage:m,postsByUser:C,isRefetching:T,refetchData:w,valueDescription:e,setValueDescription:s}},Te=d.memo(()=>{const{isLoading:e,isError:s,error:r,fetchNextPage:a,hasNextPage:n,isFetchingNextPage:c,postsByUser:l,valueDescription:u,setValueDescription:p}=_e();return t.jsx(t.Fragment,{children:t.jsx(i,{centerH:!0,className:"allpost",children:t.jsxs(i,{column:!0,className:"allpost__list",children:[t.jsx(k,{value:u,onChange:m=>p(m.target.value),id:"input_descriptoin_search",label:"Пошук",searchLabel:!0}),t.jsx(V,{hasNextPage:n,fetchNextPage:a,isLoading:e,isFetchingNextPage:c,data:l}),s&&t.jsx("h4",{children:r?.message})]})})})}),fe=e=>{const s=j(),{start:r,complete:a}=I(G),n=y({mutationFn:async c=>(r(),await P.create(c)),onError:c=>{a(),N({message:c.message})},onSuccess:()=>{e(1),M({message:"Запис додано"}),a(),s.invalidateQueries({queryKey:[h.POST_GET_ALL]}),s.invalidateQueries({queryKey:[h.POST_GET_ALL_BY_USER]})}});return{create:n.mutate,isLoading:n.isPending}},je=({background:e,text:s,name:r,setColorValue:a,colorValue:n})=>t.jsx("div",{onClick:()=>a(r),style:{backgroundColor:e,borderWidth:n===r?"3px":"1px"},className:"colorcard",children:t.jsx(i,{flex:!0,center:!0,children:t.jsx("p",{className:"colorcard__text",style:{color:s},children:"Text"})})}),Se=B({post:O({required_error:"Напишіть питання, чи оголошення"}).min(1).max(64,"Не більше 64 символів")}),ye=d.memo(({setTab:e})=>{const[s,r]=d.useState(Q.TEXTGRAY),{create:a}=fe(e),{register:n,handleSubmit:c,reset:l,formState:{errors:u}}=q({resolver:U(Se),defaultValues:{post:""}}),p=m=>{a({description:m.post,colorSchema:s}),l()};return t.jsx(t.Fragment,{children:t.jsxs(i,{gap:10,center:!0,column:!0,className:"createpost",children:[t.jsxs(i,{column:!0,center:!0,gap:5,children:[t.jsx("h2",{children:"Додайте запис"}),t.jsx("p",{children:"(Питання, оголошення, тощо)"})]}),t.jsx(i,{className:"createpost__textarea",children:t.jsx(L,{as:"textarea",heightArea:100,id:"input_title_add",...n("post"),error:u.post?.message})}),t.jsx(i,{center:!0,row:!0,gap:10,className:"createpost__color",children:re.map(m=>t.jsx(je,{colorValue:s,setColorValue:r,name:m.name,background:m.background,text:m.text},m.name))}),t.jsx(f,{onClick:c(p),appearence:"big",title:"створити"})]})})}),Ne=e=>[{title:"Дошка",components:t.jsx(Ee,{})},{title:"Мої записи",components:t.jsx(Te,{})},{title:"Створити",components:t.jsx(ye,{setTab:e})}],qe=({})=>{const e=Y(),s=S(n=>n.auth.userInfo),[r,a]=d.useState(void 0);return d.useEffect(()=>{r===1&&a(void 0)},[r]),d.useEffect(()=>{s??e(W())},[s]),t.jsx(K,{children:t.jsxs(i,{relativ:!0,column:!0,centerV:!0,spredV:!0,className:"mypage",children:[t.jsx(i,{center:!0,className:"mypage__mainbox",children:t.jsx(J,{onTab:r,render:Ne(a)})}),t.jsx(i,{className:"mypage__footer",children:s?t.jsx(i,{center:!0,gap:12,padding:!0,children:t.jsxs("p",{className:"COLORACCENT",children:[s?.name," ",s?.subname," ○ ",s?.city," ► ",s?.country]})}):t.jsx(b,{})}),t.jsx(i,{title:"MAP",gap:7,centerV:!0,className:"mypage__link",children:t.jsx(X,{to:"/mappage",children:t.jsx("h1",{children:t.jsx(A,{name:"MdOutlineMap"})})})})]})})};export{qe as default};
